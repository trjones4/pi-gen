#!/bin/bash -e
#grab the latest tarball from virtualagc master, install in pi user home

HASH="$(wget https://api.github.com/repos/virtualagc/virtualagc/git/refs/heads/master -qO -| grep \"sha\" | cut -f 2 -d ':' | cut -f 2 -d \")"

if [ -f files/virtualagc.hash ]; then
	HASH_LOCAL="$(cat files/virtualagc.hash)"
fi

if [ ! -e files/virtualagc.tar.gz ] || [ "$HASH" != "$HASH_LOCAL"  ]; then
	wget "https://github.com/virtualagc/virtualagc/tarball/master" -O files/virtualagc.tar.gz
	echo "$HASH" > files/virtualagc.hash
fi

install -v -o 1000 -g 1000 -d "${ROOTFS_DIR}/home/pi/virtualagc"

tar xvf files/virtualagc.tar.gz -C "${ROOTFS_DIR}/home/pi/virtualagc" --strip-components=1
chown 1000:1000 "${ROOTFS_DIR}/home/pi/virtualagc" -Rv

